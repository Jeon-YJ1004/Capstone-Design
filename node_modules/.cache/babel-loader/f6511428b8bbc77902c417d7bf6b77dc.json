{"ast":null,"code":"var _jsxFileName = \"C:\\\\project\\\\capstone\\\\src\\\\components\\\\result.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\n/* global kakao */\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { withRouter, Link } from 'react-router-dom';\nimport axios from 'axios';\nimport { Select, Card, Row, Col, Typography, Rate } from 'antd'; // import CafeInfo from '../routes/info/cafe_info';\n\nimport { BrowserRouter as Router, Route, Switch } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  kakao\n} = window;\nconst {\n  Title\n} = Typography;\nconst {\n  Option\n} = Select;\n\nfunction SearchData(pageNumber, params, setWidth) {\n  _s();\n\n  const {\n    place\n  } = params;\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(false); //   const [latitude,setLatitude]=useState('');\n  //   const [longitude,setLongitude]=useState('');\n  //   const [cafe_id,setCafe_id]=useState('');\n\n  const [data, setData] = useState([]);\n  const [hasMore, setHasMore] = useState(false);\n  let cancel;\n\n  const setMap = data => {\n    const container = document.getElementById(\"map\");\n    const options = {\n      center: new kakao.maps.LatLng(data[0].latitude, data[0].longitude),\n      level: 5\n    };\n\n    const handleResize = () => {\n      setWidth(window.innerWidth);\n    };\n\n    const map = new kakao.maps.Map(container, options); // 오른쪽에 지도 컨트롤 표시\n\n    var zoomControl = new kakao.maps.ZoomControl();\n    map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);\n    var bounds = new kakao.maps.LatLngBounds();\n    var imageSrc = \"https://1.bp.blogspot.com/-08ebwsVzqag/YSXWjBOHKPI/AAAAAAAAD9s/lRd5ya_9A2AgPtylT9oyilWIGohCTv9XQCLcBGAsYHQ/s834/dark_marker.png\";\n\n    for (var i = 0; i < data.length; i++) {\n      var latlng = new kakao.maps.LatLng(data[i].latitude, data[i].longitude);\n      var imageSize = new kakao.maps.Size(15, 22);\n      var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);\n      var marker = new kakao.maps.Marker({\n        map: map,\n        position: latlng,\n        title: data[i].name,\n        image: markerImage\n      }); // 마커 클릭 하면 확대\n\n      kakao.maps.event.addListener(marker, 'click', function () {\n        map.setLevel(1, {\n          anchor: this.getPosition()\n        });\n      });\n      var infowindow = new kakao.maps.InfoWindow({\n        content: `<div class=\"infoWindow\">${data[i].name}</div>`\n      });\n\n      (function (marker, infowindow) {\n        // 마커에 mouseover 이벤트를 등록하고 마우스 오버 시 인포윈도우를 표시합니다 \n        kakao.maps.event.addListener(marker, 'mouseover', function () {\n          infowindow.open(map, marker);\n          var bgDiv = infowindow.a;\n          bgDiv.style.borderColor = \"#9ba2bd\";\n          bgDiv.style.borderRadius = \"10px\";\n          bgDiv.children[1].style = \"text-align: center; width: 150px;\";\n        });\n        kakao.maps.event.addListener(marker, 'mouseout', function () {\n          infowindow.close();\n        });\n      })(marker, infowindow); // bounds = 모든 마커가 보이도록 지도 범위 설정\n\n\n      bounds.extend(latlng);\n    }\n\n    map.setBounds(bounds);\n    window.addEventListener('resize', handleResize);\n    return () => {\n      window.removeEventListener('resize', handleResize);\n    };\n  };\n\n  useEffect(() => {\n    if (pageNumber === 0) {\n      setData([]);\n    }\n\n    setLoading(true);\n    setError(false);\n    axios({\n      method: 'GET',\n      url: `/cafes?searching=${place}`,\n      params: {\n        page: pageNumber\n      },\n      cancelToken: new axios.CancelToken(c => cancel = c)\n    }).then(res => {\n      setData(prevData => {\n        return [...new Set([...prevData, ...res.data.content])];\n      });\n\n      if (pageNumber == 0) {\n        setMap(res.data.content);\n      } else {\n        setMap([...new Set([...data, ...res.data.content])]);\n      }\n\n      setHasMore(res.data.content.length > 0);\n      setLoading(false);\n    }).catch(e => {\n      if (axios.isCancel(e)) return;\n      setError(true);\n    });\n    return () => cancel();\n  }, [pageNumber, params]);\n  return {\n    data,\n    loading,\n    hasMore\n  };\n}\n\n_s(SearchData, \"nj7ayNh9j5wpHI1daP3exK3poo4=\");\n\n_c = SearchData;\n\nfunction Result(props) {\n  _s2();\n\n  const params = props.match.params;\n  const [width, setWidth] = useState(window.innerWidth);\n  const [pageNumber, setPageNumber] = useState(0);\n  const {\n    data,\n    loading,\n    error,\n    hasMore\n  } = SearchData(pageNumber, params, setWidth);\n  useEffect(() => {\n    setPageNumber(0);\n  }, [params]);\n\n  const changeSort = type => {\n    const {\n      place\n    } = params;\n    props.history.push({\n      pathname: `/search/${place}`\n    });\n  };\n\n  const observer = useRef();\n  const lastDataRef = useCallback(node => {\n    if (loading) return;\n    if (observer.current) observer.current.disconnect();\n    observer.current = new IntersectionObserver(entries => {\n      if (entries[0].isIntersecting && hasMore) {\n        setPageNumber(prevNum => prevNum + 1);\n      }\n    });\n    if (node) observer.current.observe(node);\n  }, [loading, hasMore]);\n\n  const onCafeClick = cafe => {\n    props.history.push({\n      pathname: `/search/${cafe.id}`,\n      state: {\n        cafe\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(Row, {\n    children: [\"hi\", /*#__PURE__*/_jsxDEV(Col, {\n      span: 24,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"map\",\n        style: {\n          width: `${width - 200}px`,\n          height: '40vh'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(Col, {\n      span: 24,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"sort\",\n        children: /*#__PURE__*/_jsxDEV(Select, {\n          value: props.match.params.sort,\n          onChange: changeSort,\n          children: /*#__PURE__*/_jsxDEV(Option, {\n            value: \"star\",\n            children: \"\\uBCC4\\uC810\\uC21C\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 19\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(Col, {\n      span: 24,\n      className: \"list\",\n      children: data.map((d, index) => {\n        if (data.length === index + 1) {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"listItem\",\n            ref: lastDataRef,\n            children: /*#__PURE__*/_jsxDEV(Card, {\n              children: /*#__PURE__*/_jsxDEV(Row, {\n                children: [/*#__PURE__*/_jsxDEV(Col, {\n                  span: 18,\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"info\",\n                    onClick: () => onCafeClick(d),\n                    children: [/*#__PURE__*/_jsxDEV(Title, {\n                      level: 2,\n                      style: {\n                        margin: 0,\n                        color: \"#dba56c\"\n                      },\n                      children: d.name\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 193,\n                      columnNumber: 39\n                    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      children: d.address\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 194,\n                      columnNumber: 39\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 192,\n                    columnNumber: 35\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 188,\n                  columnNumber: 31\n                }, this), /*#__PURE__*/_jsxDEV(Col, {\n                  span: 6,\n                  children: /*#__PURE__*/_jsxDEV(Rate, {\n                    allowHalf: true,\n                    disabled: true,\n                    defaultValue: d.star\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 198,\n                    columnNumber: 35\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 197,\n                  columnNumber: 31\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 187,\n                columnNumber: 27\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 186,\n              columnNumber: 23\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 19\n          }, this);\n        } else {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"listItem\",\n            children: /*#__PURE__*/_jsxDEV(Card, {\n              children: /*#__PURE__*/_jsxDEV(Row, {\n                children: [/*#__PURE__*/_jsxDEV(Col, {\n                  span: 18,\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"info\",\n                    onClick: () => onCafeClick(d),\n                    children: [/*#__PURE__*/_jsxDEV(Title, {\n                      level: 2,\n                      style: {\n                        margin: 0,\n                        color: \"#dba56c\"\n                      },\n                      children: d.name\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 215,\n                      columnNumber: 39\n                    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      children: d.address\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 216,\n                      columnNumber: 39\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 214,\n                    columnNumber: 35\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 210,\n                  columnNumber: 31\n                }, this), /*#__PURE__*/_jsxDEV(Col, {\n                  span: 6,\n                  children: /*#__PURE__*/_jsxDEV(Rate, {\n                    allowHalf: true,\n                    disabled: true,\n                    defaultValue: d.star\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 220,\n                    columnNumber: 35\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 219,\n                  columnNumber: 31\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 209,\n                columnNumber: 27\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 208,\n              columnNumber: 23\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 19\n          }, this);\n        }\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 11\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 165,\n    columnNumber: 7\n  }, this);\n}\n\n_s2(Result, \"MJt9wyWgmvn4KOMjRj3nzZ4oiTo=\");\n\n_c2 = Result;\nexport default _c3 = withRouter(Result);\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"SearchData\");\n$RefreshReg$(_c2, \"Result\");\n$RefreshReg$(_c3, \"%default%\");","map":{"version":3,"sources":["C:/project/capstone/src/components/result.js"],"names":["React","useState","useEffect","useRef","useCallback","withRouter","Link","axios","Select","Card","Row","Col","Typography","Rate","BrowserRouter","Router","Route","Switch","kakao","window","Title","Option","SearchData","pageNumber","params","setWidth","place","loading","setLoading","error","setError","data","setData","hasMore","setHasMore","cancel","setMap","container","document","getElementById","options","center","maps","LatLng","latitude","longitude","level","handleResize","innerWidth","map","Map","zoomControl","ZoomControl","addControl","ControlPosition","RIGHT","bounds","LatLngBounds","imageSrc","i","length","latlng","imageSize","Size","markerImage","MarkerImage","marker","Marker","position","title","name","image","event","addListener","setLevel","anchor","getPosition","infowindow","InfoWindow","content","open","bgDiv","a","style","borderColor","borderRadius","children","close","extend","setBounds","addEventListener","removeEventListener","method","url","page","cancelToken","CancelToken","c","then","res","prevData","Set","catch","e","isCancel","Result","props","match","width","setPageNumber","changeSort","type","history","push","pathname","observer","lastDataRef","node","current","disconnect","IntersectionObserver","entries","isIntersecting","prevNum","observe","onCafeClick","cafe","id","state","height","sort","d","index","margin","color","address","star"],"mappings":"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","sourcesContent":["/* global kakao */\r\nimport React, {useState, useEffect, useRef, useCallback} from 'react';\r\nimport { withRouter,Link} from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport { Select, Card, Row, Col, Typography, Rate } from 'antd';\r\n\r\n// import CafeInfo from '../routes/info/cafe_info';\r\n\r\nimport { BrowserRouter as Router,Route,Switch} from 'react-router-dom';\r\nconst {\r\n  kakao\r\n} = window;\r\n\r\nconst { Title } = Typography;\r\nconst { Option } = Select;\r\n\r\n\r\nfunction SearchData(pageNumber, params, setWidth){\r\n  const {place} = params\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(false);\r\n//   const [latitude,setLatitude]=useState('');\r\n//   const [longitude,setLongitude]=useState('');\r\n//   const [cafe_id,setCafe_id]=useState('');\r\n  const [data, setData] = useState([]);\r\n  const [hasMore, setHasMore] = useState(false);\r\n  let cancel;\r\n\r\n  const setMap = (data) => {\r\n      const container = document.getElementById(\"map\");\r\n      const options = {\r\n          center: new kakao.maps.LatLng(data[0].latitude, data[0].longitude),\r\n          level: 5\r\n      };\r\n      const handleResize = () => {\r\n          setWidth(window.innerWidth);\r\n      }\r\n      const map = new kakao.maps.Map(container, options);\r\n  \r\n      // 오른쪽에 지도 컨트롤 표시\r\n      var zoomControl = new kakao.maps.ZoomControl();\r\n      map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);\r\n\r\n      var bounds = new kakao.maps.LatLngBounds();    \r\n      var imageSrc = \"https://1.bp.blogspot.com/-08ebwsVzqag/YSXWjBOHKPI/AAAAAAAAD9s/lRd5ya_9A2AgPtylT9oyilWIGohCTv9XQCLcBGAsYHQ/s834/dark_marker.png\";   \r\n      for (var i = 0; i < data.length; i ++) {\r\n          var latlng = new kakao.maps.LatLng(data[i].latitude, data[i].longitude)\r\n\r\n          var imageSize = new kakao.maps.Size(15, 22); \r\n          var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize); \r\n\r\n          var marker = new kakao.maps.Marker({\r\n              map: map,\r\n              position: latlng,\r\n              title : data[i].name,\r\n              image : markerImage\r\n          });\r\n\r\n          // 마커 클릭 하면 확대\r\n          kakao.maps.event.addListener(marker, 'click', function(){\r\n              map.setLevel(1, {anchor: this.getPosition()});\r\n          });\r\n\r\n          var infowindow = new kakao.maps.InfoWindow({\r\n              content: `<div class=\"infoWindow\">${data[i].name}</div>`\r\n          });\r\n\r\n          (function(marker, infowindow) {\r\n              // 마커에 mouseover 이벤트를 등록하고 마우스 오버 시 인포윈도우를 표시합니다 \r\n              kakao.maps.event.addListener(marker, 'mouseover', function() {\r\n                  infowindow.open(map, marker);\r\n\r\n                  var bgDiv = infowindow.a\r\n                  bgDiv.style.borderColor = \"#9ba2bd\"\r\n                  bgDiv.style.borderRadius = \"10px\"\r\n                  bgDiv.children[1].style = \"text-align: center; width: 150px;\"\r\n              });\r\n\r\n              kakao.maps.event.addListener(marker, 'mouseout', function() {\r\n                  infowindow.close();\r\n              });\r\n          })(marker, infowindow);\r\n\r\n          // bounds = 모든 마커가 보이도록 지도 범위 설정\r\n          bounds.extend(latlng)\r\n      }\r\n      map.setBounds(bounds);\r\n      window.addEventListener('resize', handleResize);\r\n      return () => {\r\n          window.removeEventListener('resize', handleResize);\r\n      }\r\n  }\r\n\r\n  useEffect(() => {\r\n      if (pageNumber === 0){\r\n          setData([])\r\n      }\r\n      setLoading(true);\r\n      setError(false);\r\n      axios({\r\n          method: 'GET',\r\n          url: `/cafes?searching=${place}`,\r\n          params: { page: pageNumber },\r\n          cancelToken: new axios.CancelToken(c => cancel = c)\r\n      }).then(res => {\r\n          setData(prevData => {\r\n              \r\n              return [... new Set([...prevData, ...res.data.content])]\r\n          });\r\n          if (pageNumber == 0){\r\n              setMap(res.data.content)\r\n          } else {\r\n              setMap([... new Set([...data, ...res.data.content])])\r\n          }\r\n          setHasMore(res.data.content.length > 0);\r\n          setLoading(false);\r\n      }).catch(e => {\r\n          if (axios.isCancel(e)) return\r\n          setError(true)\r\n      })\r\n      return () => cancel()\r\n  }, [pageNumber, params])\r\n  return {data, loading, hasMore};\r\n}\r\n\r\nfunction Result(props){\r\n  const params = props.match.params\r\n\r\n  const [width, setWidth] = useState(window.innerWidth);\r\n  const [pageNumber, setPageNumber] = useState(0);\r\n  const { data, loading, error, hasMore } = SearchData(pageNumber, params, setWidth);\r\n\r\n  useEffect(() => {\r\n      setPageNumber(0)\r\n  }, [params])  \r\n\r\n  const changeSort = (type) => {\r\n      const {place} = params\r\n      props.history.push({\r\n          pathname: `/search/${place}`\r\n      })\r\n  }\r\n\r\n  const observer = useRef()\r\n  const lastDataRef = useCallback(node => {\r\n      if (loading) return\r\n      if (observer.current) observer.current.disconnect()\r\n      observer.current = new IntersectionObserver(entries => {\r\n          if (entries[0].isIntersecting && hasMore){\r\n              setPageNumber(prevNum => prevNum + 1)\r\n          }\r\n      })\r\n      if (node) observer.current.observe(node)\r\n  }, [loading, hasMore])\r\n\r\n  const onCafeClick = (cafe) => {\r\n      props.history.push({\r\n        pathname: `/search/${cafe.id}`,\r\n        state: { cafe },\r\n      });\r\n  };\r\n\r\n  return (\r\n      <Row>\r\n          hi\r\n          <Col span={24}>\r\n          <div id=\"map\" style={{\r\n              width: `${width - 200}px`,\r\n              height: '40vh'\r\n          }}>\r\n          </div>\r\n          </Col>\r\n          <Col span={24}>\r\n          <div className=\"sort\">\r\n              <Select value={props.match.params.sort} onChange={changeSort}>\r\n                  <Option value=\"star\">별점순</Option>\r\n              </Select>\r\n          </div>\r\n          </Col>\r\n          <Col span={24} className=\"list\">\r\n          {data.map((d, index) => {\r\n          if (data.length === index + 1){\r\n              return (\r\n                  <div className=\"listItem\" key={index} ref={lastDataRef}>\r\n                      <Card>\r\n                          <Row>\r\n                              <Col span={18}>\r\n                                  {/* <div className=\"img-div\">\r\n                                      <img src={d.img_path ? `http://${d.img_path}` : \"https://1.bp.blogspot.com/-ZO8wGSRzFBA/YSnWa5QV6ZI/AAAAAAAAD-Y/3n5lSJwrx-Yh3McA1GpGCg6POSjrvsPPwCLcBGAsYHQ/s800/noimage.png\"} alt={d.name} />\r\n                                  </div> */}\r\n                                  <div className=\"info\" onClick={() => onCafeClick(d)}>\r\n                                      <Title level={2} style={{margin: 0, color: \"#dba56c\"}}>{d.name}</Title>\r\n                                      <p>{d.address}</p>\r\n                                  </div>\r\n                              </Col>\r\n                              <Col span={6}>\r\n                                  <Rate allowHalf disabled defaultValue={d.star} />\r\n                              </Col>\r\n                          </Row>\r\n                      </Card>\r\n                  </div>\r\n              )\r\n          }\r\n          else {\r\n              return (\r\n                  <div className=\"listItem\" key={index}>\r\n                      <Card>\r\n                          <Row>\r\n                              <Col span={18}>\r\n                                  {/* <div className=\"img-div\">\r\n                                      <img src={d.img_path ? `http://${d.img_path}` : \"https://1.bp.blogspot.com/-ZO8wGSRzFBA/YSnWa5QV6ZI/AAAAAAAAD-Y/3n5lSJwrx-Yh3McA1GpGCg6POSjrvsPPwCLcBGAsYHQ/s800/noimage.png\"} alt={d.name} />\r\n                                  </div> */}\r\n                                  <div className=\"info\" onClick={() => onCafeClick(d)}>\r\n                                      <Title level={2} style={{margin: 0, color: \"#dba56c\"}}>{d.name}</Title>\r\n                                      <p>{d.address}</p>\r\n                                  </div>\r\n                              </Col>\r\n                              <Col span={6}>\r\n                                  <Rate allowHalf disabled defaultValue={d.star} />\r\n                              </Col>\r\n                          </Row>\r\n                      </Card>\r\n                  </div>\r\n              )\r\n          }\r\n      })}\r\n          </Col>\r\n      </Row>\r\n  )\r\n}\r\n\r\nexport default withRouter(Result)"]},"metadata":{},"sourceType":"module"}