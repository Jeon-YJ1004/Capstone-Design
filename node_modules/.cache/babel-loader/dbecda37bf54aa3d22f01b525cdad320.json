{"ast":null,"code":"var _jsxFileName = \"C:\\\\project\\\\capstone\\\\src\\\\components\\\\result.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\n/* global kakao */\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { withRouter, Link } from 'react-router-dom';\nimport axios from 'axios';\nimport { Select, Card, Row, Col, Typography, Rate } from 'antd'; // import CafeInfo from '../routes/info/cafe_info';\n\nimport { BrowserRouter as Router, Route, Switch } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  kakao\n} = window;\nconst {\n  Title\n} = Typography;\nconst {\n  Option\n} = Select;\n\nfunction SearchData(pageNumber, params, setWidth) {\n  _s();\n\n  const {\n    place\n  } = params;\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(false);\n  const [data, setData] = useState([]);\n  const [hasMore, setHasMore] = useState(false);\n  let cancel;\n\n  const setMap = data => {\n    window.kakao.maps.load(() => {\n      const container = document.getElementById(\"map\");\n      const options = {\n        center: new kakao.maps.LatLng(data[0].latitude, data[0].longitude),\n        level: 5\n      };\n\n      const handleResize = () => {\n        setWidth(window.innerWidth);\n      };\n\n      const map = new kakao.maps.Map(container, options); // 오른쪽에 지도 컨트롤 표시\n\n      var zoomControl = new kakao.maps.ZoomControl();\n      map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);\n      var bounds = new kakao.maps.LatLngBounds();\n      var imageSrc = \"https://1.bp.blogspot.com/-08ebwsVzqag/YSXWjBOHKPI/AAAAAAAAD9s/lRd5ya_9A2AgPtylT9oyilWIGohCTv9XQCLcBGAsYHQ/s834/dark_marker.png\";\n\n      for (var i = 0; i < data.length; i++) {\n        var latlng = new kakao.maps.LatLng(data[i].latitude, data[i].longitude);\n        var imageSize = new kakao.maps.Size(15, 22);\n        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);\n        var marker = new kakao.maps.Marker({\n          map: map,\n          position: latlng,\n          title: data[i].name,\n          image: markerImage\n        }); // 마커 클릭 하면 확대\n\n        kakao.maps.event.addListener(marker, 'click', function () {\n          map.setLevel(1, {\n            anchor: this.getPosition()\n          });\n        });\n        var infowindow = new kakao.maps.InfoWindow({\n          content: `<div class=\"infoWindow\">${data[i].name}</div>`\n        });\n\n        (function (marker, infowindow) {\n          // 마커에 mouseover 이벤트를 등록하고 마우스 오버 시 인포윈도우를 표시합니다 \n          kakao.maps.event.addListener(marker, 'mouseover', function () {\n            infowindow.open(map, marker);\n            var bgDiv = infowindow.a;\n            bgDiv.style.borderColor = \"#9ba2bd\";\n            bgDiv.style.borderRadius = \"10px\";\n            bgDiv.children[1].style = \"text-align: center; width: 150px;\";\n          });\n          kakao.maps.event.addListener(marker, 'mouseout', function () {\n            infowindow.close();\n          });\n        })(marker, infowindow); // bounds = 모든 마커가 보이도록 지도 범위 설정\n\n\n        bounds.extend(latlng);\n      }\n\n      map.setBounds(bounds);\n      window.addEventListener('resize', handleResize);\n      return () => {\n        window.removeEventListener('resize', handleResize);\n      };\n    });\n  };\n\n  useEffect(() => {\n    if (pageNumber === 0) {\n      setData([]);\n    }\n\n    setLoading(true);\n    setError(false);\n    axios({\n      method: 'GET',\n      url: `/cafes?searching=${place}`,\n      params: {\n        page: pageNumber\n      },\n      cancelToken: new axios.CancelToken(c => cancel = c)\n    }).then(res => {\n      setData(prevData => {\n        return [...new Set([...prevData, ...res.data.content])];\n      });\n\n      if (pageNumber == 0) {\n        setMap(res.data.content);\n      } else {\n        setMap([...new Set([...data, ...res.data.content])]);\n      }\n\n      setHasMore(res.data.content.length > 0);\n      setLoading(false);\n    }).catch(e => {\n      if (axios.isCancel(e)) return;\n      setError(true);\n    });\n    return () => cancel();\n  }, [pageNumber, params]);\n  return {\n    data,\n    loading,\n    hasMore\n  };\n}\n\n_s(SearchData, \"nj7ayNh9j5wpHI1daP3exK3poo4=\");\n\n_c = SearchData;\n\nfunction Result(props) {\n  _s2();\n\n  const params = props.match.params;\n  const [width, setWidth] = useState(window.innerWidth);\n  const [pageNumber, setPageNumber] = useState(0);\n  const {\n    data,\n    loading,\n    error,\n    hasMore\n  } = SearchData(pageNumber, params, setWidth);\n  useEffect(() => {\n    setPageNumber(0);\n  }, [params]);\n\n  const changeSort = type => {\n    const {\n      place\n    } = params;\n    props.history.push({\n      pathname: `/search/${place}`\n    });\n  };\n\n  const observer = useRef();\n  const lastDataRef = useCallback(node => {\n    if (loading) return;\n    if (observer.current) observer.current.disconnect();\n    observer.current = new IntersectionObserver(entries => {\n      if (entries[0].isIntersecting && hasMore) {\n        setPageNumber(prevNum => prevNum + 1);\n      }\n    });\n    if (node) observer.current.observe(node);\n  }, [loading, hasMore]);\n\n  const onCafeClick = cafe => {\n    props.history.push({\n      pathname: `/search/${cafe.id}`,\n      state: {\n        cafe\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(Row, {\n    children: [/*#__PURE__*/_jsxDEV(Col, {\n      span: 24,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"map\",\n        style: {\n          width: `${width - 200}px`,\n          height: '40vh'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Col, {\n      span: 24,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"sort\",\n        children: /*#__PURE__*/_jsxDEV(Select, {\n          value: props.match.params.sort,\n          onChange: changeSort,\n          children: /*#__PURE__*/_jsxDEV(Option, {\n            value: \"star\",\n            children: \"\\uBCC4\\uC810\\uC21C\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Col, {\n      span: 24,\n      className: \"list\",\n      children: data.map((d, index) => {\n        if (data.length === index + 1) {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"listItem\",\n            ref: lastDataRef,\n            children: /*#__PURE__*/_jsxDEV(Card, {\n              children: /*#__PURE__*/_jsxDEV(Row, {\n                children: [/*#__PURE__*/_jsxDEV(Col, {\n                  span: 18,\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"info\",\n                    onClick: () => onCafeClick(d),\n                    children: [/*#__PURE__*/_jsxDEV(Title, {\n                      level: 2,\n                      style: {\n                        margin: 0,\n                        color: \"#dba56c\"\n                      },\n                      children: d.name\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 193,\n                      columnNumber: 37\n                    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      children: d.address\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 194,\n                      columnNumber: 37\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 192,\n                    columnNumber: 33\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 188,\n                  columnNumber: 29\n                }, this), /*#__PURE__*/_jsxDEV(Col, {\n                  span: 6,\n                  children: /*#__PURE__*/_jsxDEV(Rate, {\n                    allowHalf: true,\n                    disabled: true,\n                    defaultValue: d.star\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 198,\n                    columnNumber: 33\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 197,\n                  columnNumber: 29\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 187,\n                columnNumber: 25\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 186,\n              columnNumber: 21\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 17\n          }, this);\n        } else {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"listItem\",\n            children: /*#__PURE__*/_jsxDEV(Card, {\n              children: /*#__PURE__*/_jsxDEV(Row, {\n                children: [/*#__PURE__*/_jsxDEV(Col, {\n                  span: 18,\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"info\",\n                    onClick: () => onCafeClick(d),\n                    children: [/*#__PURE__*/_jsxDEV(Title, {\n                      level: 2,\n                      style: {\n                        margin: 0,\n                        color: \"#dba56c\"\n                      },\n                      children: d.name\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 215,\n                      columnNumber: 37\n                    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      children: d.address\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 216,\n                      columnNumber: 37\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 214,\n                    columnNumber: 33\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 210,\n                  columnNumber: 29\n                }, this), /*#__PURE__*/_jsxDEV(Col, {\n                  span: 6,\n                  children: /*#__PURE__*/_jsxDEV(Rate, {\n                    allowHalf: true,\n                    disabled: true,\n                    defaultValue: d.star\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 220,\n                    columnNumber: 33\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 219,\n                  columnNumber: 29\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 209,\n                columnNumber: 25\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 208,\n              columnNumber: 21\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 17\n          }, this);\n        }\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 166,\n    columnNumber: 5\n  }, this);\n}\n\n_s2(Result, \"MJt9wyWgmvn4KOMjRj3nzZ4oiTo=\");\n\n_c2 = Result;\nexport default _c3 = withRouter(Result);\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"SearchData\");\n$RefreshReg$(_c2, \"Result\");\n$RefreshReg$(_c3, \"%default%\");","map":{"version":3,"sources":["C:/project/capstone/src/components/result.js"],"names":["React","useState","useEffect","useRef","useCallback","withRouter","Link","axios","Select","Card","Row","Col","Typography","Rate","BrowserRouter","Router","Route","Switch","kakao","window","Title","Option","SearchData","pageNumber","params","setWidth","place","loading","setLoading","error","setError","data","setData","hasMore","setHasMore","cancel","setMap","maps","load","container","document","getElementById","options","center","LatLng","latitude","longitude","level","handleResize","innerWidth","map","Map","zoomControl","ZoomControl","addControl","ControlPosition","RIGHT","bounds","LatLngBounds","imageSrc","i","length","latlng","imageSize","Size","markerImage","MarkerImage","marker","Marker","position","title","name","image","event","addListener","setLevel","anchor","getPosition","infowindow","InfoWindow","content","open","bgDiv","a","style","borderColor","borderRadius","children","close","extend","setBounds","addEventListener","removeEventListener","method","url","page","cancelToken","CancelToken","c","then","res","prevData","Set","catch","e","isCancel","Result","props","match","width","setPageNumber","changeSort","type","history","push","pathname","observer","lastDataRef","node","current","disconnect","IntersectionObserver","entries","isIntersecting","prevNum","observe","onCafeClick","cafe","id","state","height","sort","d","index","margin","color","address","star"],"mappings":"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","sourcesContent":["/* global kakao */\r\nimport React, {useState, useEffect, useRef, useCallback} from 'react';\r\nimport { withRouter,Link} from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport { Select, Card, Row, Col, Typography, Rate } from 'antd';\r\n\r\n// import CafeInfo from '../routes/info/cafe_info';\r\n\r\nimport { BrowserRouter as Router,Route,Switch} from 'react-router-dom';\r\nconst {\r\n  kakao\r\n} = window;\r\n\r\nconst { Title } = Typography;\r\nconst { Option } = Select;\r\n\r\n\r\nfunction SearchData(pageNumber, params, setWidth){\r\n    \r\n    const {place} = params\r\n  \r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(false);\r\n    const [data, setData] = useState([]);\r\n    const [hasMore, setHasMore] = useState(false);\r\n    let cancel;\r\n\r\n    const setMap = (data) => {\r\n        window.kakao.maps.load(() => {\r\n            const container = document.getElementById(\"map\");\r\n            const options = {\r\n                center: new kakao.maps.LatLng(data[0].latitude, data[0].longitude),\r\n                level: 5\r\n            };\r\n            \r\n            const handleResize = () => {\r\n                setWidth(window.innerWidth);\r\n            }\r\n            const map = new kakao.maps.Map(container, options);\r\n        \r\n            // 오른쪽에 지도 컨트롤 표시\r\n            var zoomControl = new kakao.maps.ZoomControl();\r\n            map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);\r\n\r\n            var bounds = new kakao.maps.LatLngBounds();    \r\n            var imageSrc = \"https://1.bp.blogspot.com/-08ebwsVzqag/YSXWjBOHKPI/AAAAAAAAD9s/lRd5ya_9A2AgPtylT9oyilWIGohCTv9XQCLcBGAsYHQ/s834/dark_marker.png\";   \r\n            for (var i = 0; i < data.length; i ++) {\r\n                var latlng = new kakao.maps.LatLng(data[i].latitude, data[i].longitude)\r\n\r\n                var imageSize = new kakao.maps.Size(15, 22); \r\n                var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize); \r\n\r\n                var marker = new kakao.maps.Marker({\r\n                    map: map,\r\n                    position: latlng,\r\n                    title : data[i].name,\r\n                    image : markerImage\r\n                });\r\n\r\n                // 마커 클릭 하면 확대\r\n                kakao.maps.event.addListener(marker, 'click', function(){\r\n                    map.setLevel(1, {anchor: this.getPosition()});\r\n                });\r\n\r\n                var infowindow = new kakao.maps.InfoWindow({\r\n                    content: `<div class=\"infoWindow\">${data[i].name}</div>`\r\n                });\r\n\r\n                (function(marker, infowindow) {\r\n                    // 마커에 mouseover 이벤트를 등록하고 마우스 오버 시 인포윈도우를 표시합니다 \r\n                    kakao.maps.event.addListener(marker, 'mouseover', function() {\r\n                        infowindow.open(map, marker);\r\n\r\n                        var bgDiv = infowindow.a\r\n                        bgDiv.style.borderColor = \"#9ba2bd\"\r\n                        bgDiv.style.borderRadius = \"10px\"\r\n                        bgDiv.children[1].style = \"text-align: center; width: 150px;\"\r\n                    });\r\n\r\n                    kakao.maps.event.addListener(marker, 'mouseout', function() {\r\n                        infowindow.close();\r\n                    });\r\n                })(marker, infowindow);\r\n\r\n                // bounds = 모든 마커가 보이도록 지도 범위 설정\r\n                bounds.extend(latlng)\r\n            }\r\n            map.setBounds(bounds);\r\n            window.addEventListener('resize', handleResize);\r\n            return () => {\r\n                window.removeEventListener('resize', handleResize);\r\n            }\r\n        });\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (pageNumber === 0){\r\n            setData([])\r\n        }\r\n        setLoading(true);\r\n        setError(false);\r\n        axios({\r\n            method: 'GET',\r\n            url: `/cafes?searching=${place}`,\r\n            params: { page: pageNumber },\r\n            cancelToken: new axios.CancelToken(c => cancel = c)\r\n        }).then(res => {\r\n            setData(prevData => {\r\n                return [... new Set([...prevData, ...res.data.content])]\r\n            });\r\n            if (pageNumber == 0){\r\n                setMap(res.data.content)\r\n            } else {\r\n                setMap([... new Set([...data, ...res.data.content])])\r\n            }\r\n            setHasMore(res.data.content.length > 0);\r\n            setLoading(false);\r\n        }).catch(e => {\r\n            if (axios.isCancel(e)) return\r\n            setError(true)\r\n        })\r\n        return () => cancel()\r\n    }, [pageNumber, params])\r\n    return {data, loading, hasMore};\r\n}\r\n\r\n\r\nfunction Result(props){\r\nconst params = props.match.params\r\n\r\nconst [width, setWidth] = useState(window.innerWidth);\r\nconst [pageNumber, setPageNumber] = useState(0);\r\nconst { data, loading, error, hasMore } = SearchData(pageNumber, params, setWidth);\r\n\r\nuseEffect(() => {\r\n    setPageNumber(0)\r\n}, [params])\r\n\r\nconst changeSort = (type) => {\r\n    const {place} = params\r\n    props.history.push({\r\n        pathname: `/search/${place}`\r\n    })\r\n}\r\n\r\nconst observer = useRef()\r\nconst lastDataRef = useCallback(node => {\r\n    if (loading) return\r\n    if (observer.current) observer.current.disconnect()\r\n    observer.current = new IntersectionObserver(entries => {\r\n        if (entries[0].isIntersecting && hasMore){\r\n            setPageNumber(prevNum => prevNum + 1)\r\n        }\r\n    })\r\n    if (node) observer.current.observe(node)\r\n}, [loading, hasMore])\r\n\r\nconst onCafeClick = (cafe) => {\r\n    props.history.push({\r\n        pathname: `/search/${cafe.id}`,\r\n        state: { cafe },\r\n    });\r\n};\r\n\r\nreturn (\r\n    <Row>\r\n        <Col span={24}>\r\n        <div id=\"map\" style={{\r\n            width: `${width - 200}px`,\r\n            height: '40vh'\r\n        }}>\r\n        </div>\r\n        </Col>\r\n        <Col span={24}>\r\n        <div className=\"sort\">\r\n            <Select value={props.match.params.sort} onChange={changeSort}>\r\n                <Option value=\"star\">별점순</Option>\r\n            </Select>\r\n        </div>\r\n        </Col>\r\n        <Col span={24} className=\"list\">\r\n        {data.map((d, index) => {\r\n        if (data.length === index + 1){\r\n            return (\r\n                <div className=\"listItem\" key={index} ref={lastDataRef}>\r\n                    <Card>\r\n                        <Row>\r\n                            <Col span={18}>\r\n                                {/* <div className=\"img-div\">\r\n                                    <img src={d.img_path ? `http://${d.img_path}` : \"https://1.bp.blogspot.com/-ZO8wGSRzFBA/YSnWa5QV6ZI/AAAAAAAAD-Y/3n5lSJwrx-Yh3McA1GpGCg6POSjrvsPPwCLcBGAsYHQ/s800/noimage.png\"} alt={d.name} />\r\n                                </div> */}\r\n                                <div className=\"info\" onClick={() => onCafeClick(d)}>\r\n                                    <Title level={2} style={{margin: 0, color: \"#dba56c\"}}>{d.name}</Title>\r\n                                    <p>{d.address}</p>\r\n                                </div>\r\n                            </Col>\r\n                            <Col span={6}>\r\n                                <Rate allowHalf disabled defaultValue={d.star} />\r\n                            </Col>\r\n                        </Row>\r\n                    </Card>\r\n                </div>\r\n            )\r\n        }\r\n        else {\r\n            return (\r\n                <div className=\"listItem\" key={index}>\r\n                    <Card>\r\n                        <Row>\r\n                            <Col span={18}>\r\n                                {/* <div className=\"img-div\">\r\n                                    <img src={d.img_path ? `http://${d.img_path}` : \"https://1.bp.blogspot.com/-ZO8wGSRzFBA/YSnWa5QV6ZI/AAAAAAAAD-Y/3n5lSJwrx-Yh3McA1GpGCg6POSjrvsPPwCLcBGAsYHQ/s800/noimage.png\"} alt={d.name} />\r\n                                </div> */}\r\n                                <div className=\"info\" onClick={() => onCafeClick(d)}>\r\n                                    <Title level={2} style={{margin: 0, color: \"#dba56c\"}}>{d.name}</Title>\r\n                                    <p>{d.address}</p>\r\n                                </div>\r\n                            </Col>\r\n                            <Col span={6}>\r\n                                <Rate allowHalf disabled defaultValue={d.star} />\r\n                            </Col>\r\n                        </Row>\r\n                    </Card>\r\n                </div>\r\n            )\r\n        }\r\n    })}\r\n        </Col>\r\n    </Row>\r\n)\r\n}\r\n\r\nexport default withRouter(Result)"]},"metadata":{},"sourceType":"module"}