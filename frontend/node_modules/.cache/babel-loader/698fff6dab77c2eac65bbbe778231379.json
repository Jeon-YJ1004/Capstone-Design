{"ast":null,"code":"var _jsxFileName = \"C:\\\\project\\\\capstone\\\\frontend\\\\src\\\\components\\\\result.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\n/* global kakao */\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { withRouter, Link } from 'react-router-dom';\nimport axios from 'axios';\nimport { Select, Card, Row, Col, Typography, Rate } from 'antd';\nimport '../styles/results.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  kakao\n} = window;\nconst {\n  Title\n} = Typography;\nconst {\n  Option\n} = Select;\n\nfunction SearchData(pageNumber, params, setWidth) {\n  _s();\n\n  const {\n    place,\n    gu\n  } = params;\n  console.log(place);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(false);\n  const [data, setData] = useState([]);\n  const [hasMore, setHasMore] = useState(false);\n  let cancel;\n\n  const setMap = data => {\n    const container = document.getElementById(\"map\");\n    const options = {\n      center: new kakao.maps.LatLng(data[0].latitude, data[0].longitude),\n      level: 5\n    };\n\n    const handleResize = () => {\n      setWidth(window.innerWidth);\n    };\n\n    const map = new kakao.maps.Map(container, options); // 오른쪽에 지도 컨트롤 표시\n\n    var zoomControl = new kakao.maps.ZoomControl();\n    map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);\n    var bounds = new kakao.maps.LatLngBounds();\n    var imageSrc = \"https://1.bp.blogspot.com/-08ebwsVzqag/YSXWjBOHKPI/AAAAAAAAD9s/lRd5ya_9A2AgPtylT9oyilWIGohCTv9XQCLcBGAsYHQ/s834/dark_marker.png\";\n\n    for (var i = 0; i < data.length; i++) {\n      var latlng = new kakao.maps.LatLng(data[0].latitude, data[0].longitude);\n      var imageSize = new kakao.maps.Size(15, 22);\n      var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);\n      var marker = new kakao.maps.Marker({\n        map: map,\n        position: latlng,\n        title: data[i].name,\n        image: markerImage\n      }); // 마커 클릭 하면 확대\n\n      kakao.maps.event.addListener(marker, 'click', function () {\n        map.setLevel(1, {\n          anchor: this.getPosition()\n        });\n      });\n      var infowindow = new kakao.maps.InfoWindow({\n        content: `<div class=\"infoWindow\">${data[i].name}</div>`\n      });\n\n      (function (marker, infowindow) {\n        // 마커에 mouseover 이벤트를 등록하고 마우스 오버 시 인포윈도우를 표시합니다\n        kakao.maps.event.addListener(marker, 'mouseover', function () {\n          infowindow.open(map, marker);\n          var bgDiv = infowindow.a;\n          bgDiv.style.borderColor = \"#9ba2bd\";\n          bgDiv.style.borderRadius = \"10px\";\n          bgDiv.children[1].style = \"text-align: center; width: 150px;\";\n        });\n        kakao.maps.event.addListener(marker, 'mouseout', function () {\n          infowindow.close();\n        });\n      })(marker, infowindow); // bounds = 모든 마커가 보이도록 지도 범위 설정\n\n\n      bounds.extend(latlng);\n    }\n\n    map.setBounds(bounds);\n    window.addEventListener('resize', handleResize);\n    return () => {\n      window.removeEventListener('resize', handleResize);\n    };\n  };\n\n  useEffect(() => {\n    if (pageNumber === 0) {\n      setData([]);\n    }\n\n    setLoading(true);\n    setError(false);\n    axios({\n      method: 'GET',\n      url: `/search?gu=${gu}&place=${place}`,\n      params: {\n        page: pageNumber\n      },\n      cancelToken: new axios.CancelToken(c => cancel = c)\n    }).then(res => {\n      setData(prevData => {\n        return [...new Set([...prevData, ...res.data.content])];\n      });\n\n      if (pageNumber == 0) {\n        setMap(res.data.content);\n      } else {\n        setMap([...new Set([...data, ...res.data.content])]);\n      }\n\n      setHasMore(res.data.content.length > 0);\n      setLoading(false);\n    }).catch(e => {\n      if (axios.isCancel(e)) return;\n      setError(true);\n    });\n    return () => cancel();\n  }, [pageNumber, params]);\n  return {\n    data,\n    loading,\n    hasMore\n  };\n}\n\n_s(SearchData, \"nj7ayNh9j5wpHI1daP3exK3poo4=\");\n\n_c = SearchData;\n\nfunction Result(props) {\n  _s2();\n\n  const params = props.match.params;\n  const [width, setWidth] = useState(window.innerWidth);\n  const [pageNumber, setPageNumber] = useState(0);\n  const {\n    data,\n    loading,\n    error,\n    hasMore\n  } = SearchData(pageNumber, params, setWidth);\n  useEffect(() => {\n    setPageNumber(0);\n  }, [params]);\n  const observer = useRef();\n  const lastDataRef = useCallback(node => {\n    if (loading) return;\n    if (observer.current) observer.current.disconnect();\n    observer.current = new IntersectionObserver(entries => {\n      if (entries[0].isIntersecting && hasMore) {\n        setPageNumber(prevNum => prevNum + 1);\n      }\n    });\n    if (node) observer.current.observe(node);\n  }, [loading, hasMore]);\n\n  const onCafeClick = cafe => {\n    props.history.push({\n      pathname: `/info/${cafe.id}`,\n      state: {\n        cafe\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(Row, {\n    children: [/*#__PURE__*/_jsxDEV(Col, {\n      span: 24,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"map\",\n        style: {\n          width: `${width - 200}px`\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Col, {\n      span: 24\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Col, {\n      span: 24,\n      className: \"list\",\n      children: data.map((d, index) => {\n        if (data.length === index + 1) {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"listItem\",\n            ref: lastDataRef,\n            children: /*#__PURE__*/_jsxDEV(Card, {\n              bordered: false,\n              style: {\n                width: 300\n              },\n              children: /*#__PURE__*/_jsxDEV(Row, {\n                children: [/*#__PURE__*/_jsxDEV(Col, {\n                  span: 18,\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"info\",\n                    onClick: () => onCafeClick(d),\n                    children: [/*#__PURE__*/_jsxDEV(Title, {\n                      level: 2,\n                      style: {\n                        margin: 0,\n                        color: \"#aaaa\"\n                      },\n                      children: d.name\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 170,\n                      columnNumber: 49\n                    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      children: d.address\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 171,\n                      columnNumber: 49\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 169,\n                    columnNumber: 45\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 168,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(Col, {\n                  span: 6\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 174,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 167,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 166,\n              columnNumber: 33\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 29\n          }, this);\n        } else {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"listItem\",\n            children: /*#__PURE__*/_jsxDEV(Card, {\n              children: /*#__PURE__*/_jsxDEV(Row, {\n                children: [/*#__PURE__*/_jsxDEV(Col, {\n                  span: 18,\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"info\",\n                    onClick: () => onCafeClick(d),\n                    children: [/*#__PURE__*/_jsxDEV(Title, {\n                      level: 2,\n                      style: {\n                        margin: 0,\n                        color: \"#aaaa\"\n                      },\n                      children: d.name\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 188,\n                      columnNumber: 49\n                    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      children: d.address\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 189,\n                      columnNumber: 49\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 187,\n                    columnNumber: 45\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 186,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(Col, {\n                  span: 6\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 192,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 185,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 184,\n              columnNumber: 33\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 29\n          }, this);\n        }\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 153,\n    columnNumber: 9\n  }, this);\n}\n\n_s2(Result, \"MJt9wyWgmvn4KOMjRj3nzZ4oiTo=\");\n\n_c2 = Result;\nexport default _c3 = withRouter(Result);\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"SearchData\");\n$RefreshReg$(_c2, \"Result\");\n$RefreshReg$(_c3, \"%default%\");","map":{"version":3,"sources":["C:/project/capstone/frontend/src/components/result.js"],"names":["React","useState","useEffect","useRef","useCallback","withRouter","Link","axios","Select","Card","Row","Col","Typography","Rate","kakao","window","Title","Option","SearchData","pageNumber","params","setWidth","place","gu","console","log","loading","setLoading","error","setError","data","setData","hasMore","setHasMore","cancel","setMap","container","document","getElementById","options","center","maps","LatLng","latitude","longitude","level","handleResize","innerWidth","map","Map","zoomControl","ZoomControl","addControl","ControlPosition","RIGHT","bounds","LatLngBounds","imageSrc","i","length","latlng","imageSize","Size","markerImage","MarkerImage","marker","Marker","position","title","name","image","event","addListener","setLevel","anchor","getPosition","infowindow","InfoWindow","content","open","bgDiv","a","style","borderColor","borderRadius","children","close","extend","setBounds","addEventListener","removeEventListener","method","url","page","cancelToken","CancelToken","c","then","res","prevData","Set","catch","e","isCancel","Result","props","match","width","setPageNumber","observer","lastDataRef","node","current","disconnect","IntersectionObserver","entries","isIntersecting","prevNum","observe","onCafeClick","cafe","history","push","pathname","id","state","d","index","margin","color","address"],"mappings":"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","sourcesContent":["/* global kakao */\r\nimport React, {useState, useEffect, useRef, useCallback} from 'react';\r\nimport {withRouter, Link} from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport {Select, Card, Row, Col, Typography, Rate} from 'antd';\r\nimport '../styles/results.css'\r\n\r\nconst {\r\n    kakao\r\n} = window;\r\n\r\nconst {Title} = Typography;\r\nconst {Option} = Select;\r\n\r\n\r\nfunction SearchData(pageNumber, params, setWidth) {\r\n    const {place, gu} = params\r\n    console.log(place)\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(false);\r\n\r\n    const [data, setData] = useState([]);\r\n    const [hasMore, setHasMore] = useState(false);\r\n    let cancel;\r\n\r\n    const setMap = (data) => {\r\n        const container = document.getElementById(\"map\");\r\n        const options = {\r\n            center: new kakao.maps.LatLng(data[0].latitude, data[0].longitude),\r\n            level: 5\r\n        };\r\n        const handleResize = () => {\r\n            setWidth(window.innerWidth);\r\n        }\r\n        const map = new kakao.maps.Map(container, options);\r\n\r\n        // 오른쪽에 지도 컨트롤 표시\r\n        var zoomControl = new kakao.maps.ZoomControl();\r\n        map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);\r\n\r\n        var bounds = new kakao.maps.LatLngBounds();\r\n        var imageSrc = \"https://1.bp.blogspot.com/-08ebwsVzqag/YSXWjBOHKPI/AAAAAAAAD9s/lRd5ya_9A2AgPtylT9oyilWIGohCTv9XQCLcBGAsYHQ/s834/dark_marker.png\";\r\n        for (var i = 0; i < data.length; i++) {\r\n            var latlng = new kakao.maps.LatLng(data[0].latitude, data[0].longitude)\r\n\r\n            var imageSize = new kakao.maps.Size(15, 22);\r\n            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);\r\n\r\n            var marker = new kakao.maps.Marker({\r\n                map: map,\r\n                position: latlng,\r\n                title: data[i].name,\r\n                image: markerImage\r\n            });\r\n\r\n            // 마커 클릭 하면 확대\r\n            kakao.maps.event.addListener(marker, 'click', function () {\r\n                map.setLevel(1, {anchor: this.getPosition()});\r\n            });\r\n\r\n            var infowindow = new kakao.maps.InfoWindow({\r\n                content: `<div class=\"infoWindow\">${data[i].name}</div>`\r\n            });\r\n\r\n            (function (marker, infowindow) {\r\n                // 마커에 mouseover 이벤트를 등록하고 마우스 오버 시 인포윈도우를 표시합니다\r\n                kakao.maps.event.addListener(marker, 'mouseover', function () {\r\n                    infowindow.open(map, marker);\r\n\r\n                    var bgDiv = infowindow.a\r\n                    bgDiv.style.borderColor = \"#9ba2bd\"\r\n                    bgDiv.style.borderRadius = \"10px\"\r\n                    bgDiv.children[1].style = \"text-align: center; width: 150px;\"\r\n                });\r\n\r\n                kakao.maps.event.addListener(marker, 'mouseout', function () {\r\n                    infowindow.close();\r\n                });\r\n            })(marker, infowindow);\r\n\r\n            // bounds = 모든 마커가 보이도록 지도 범위 설정\r\n            bounds.extend(latlng)\r\n        }\r\n        map.setBounds(bounds);\r\n        window.addEventListener('resize', handleResize);\r\n        return () => {\r\n            window.removeEventListener('resize', handleResize);\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (pageNumber === 0) {\r\n            setData([])\r\n        }\r\n        setLoading(true);\r\n        setError(false);\r\n        axios({\r\n            method: 'GET',\r\n            url: `/search?gu=${gu}&place=${place}`,\r\n            params: {page: pageNumber},\r\n            cancelToken: new axios.CancelToken(c => cancel = c)\r\n        }).then(res => {\r\n            setData(prevData => {\r\n\r\n                return [...new Set([...prevData, ...res.data.content])]\r\n            });\r\n            if (pageNumber == 0) {\r\n                setMap(res.data.content)\r\n            } else {\r\n                setMap([...new Set([...data, ...res.data.content])])\r\n            }\r\n            setHasMore(res.data.content.length > 0);\r\n            setLoading(false);\r\n        }).catch(e => {\r\n            if (axios.isCancel(e)) return\r\n            setError(true)\r\n        })\r\n        return () => cancel()\r\n    }, [pageNumber, params])\r\n    return {data, loading, hasMore};\r\n}\r\n\r\nfunction Result(props) {\r\n    const params = props.match.params\r\n    const [width, setWidth] = useState(window.innerWidth);\r\n    const [pageNumber, setPageNumber] = useState(0);\r\n    const {data, loading, error, hasMore} = SearchData(pageNumber, params, setWidth);\r\n\r\n    useEffect(() => {\r\n        setPageNumber(0)\r\n    }, [params])\r\n\r\n    const observer = useRef()\r\n    const lastDataRef = useCallback(node => {\r\n        if (loading) return\r\n        if (observer.current) observer.current.disconnect()\r\n        observer.current = new IntersectionObserver(entries => {\r\n            if (entries[0].isIntersecting && hasMore) {\r\n                setPageNumber(prevNum => prevNum + 1)\r\n            }\r\n        })\r\n        if (node) observer.current.observe(node)\r\n    }, [loading, hasMore])\r\n\r\n    const onCafeClick = (cafe) => {\r\n        props.history.push({\r\n            pathname: `/info/${cafe.id}`,\r\n            state: {cafe},\r\n        });\r\n    };\r\n\r\n    return (\r\n        <Row>\r\n            <Col span={24}>\r\n                <div id=\"map\" style={{\r\n                    width: `${width - 200}px`\r\n                }}></div>\r\n            </Col>\r\n            <Col span={24}>\r\n            </Col>\r\n            <Col span={24} className=\"list\">\r\n                {data.map((d, index) => {\r\n                    if (data.length === index + 1) {\r\n                        return (\r\n                            <div className=\"listItem\" key={index} ref={lastDataRef}>\r\n                                <Card bordered={false} style={{ width: 300 }}>\r\n                                    <Row>\r\n                                        <Col span={18}>\r\n                                            <div className=\"info\" onClick={() => onCafeClick(d)}>\r\n                                                <Title level={2} style={{margin: 0, color: \"#aaaa\"}}>{d.name}</Title>\r\n                                                <p>{d.address}</p>\r\n                                            </div>\r\n                                        </Col>\r\n                                        <Col span={6}>\r\n                                            {/*<Rate allowHalf disabled defaultValue={d.score}/>*/}\r\n                                        </Col>\r\n                                    </Row>\r\n                                </Card>\r\n                            </div>\r\n                        )\r\n                    } else {\r\n                        return (\r\n                            <div className=\"listItem\" key={index}>\r\n                                <Card>\r\n                                    <Row>\r\n                                        <Col span={18}>\r\n                                            <div className=\"info\" onClick={() => onCafeClick(d)}>\r\n                                                <Title level={2} style={{margin: 0, color: \"#aaaa\"}}>{d.name}</Title>\r\n                                                <p>{d.address}</p>\r\n                                            </div>\r\n                                        </Col>\r\n                                        <Col span={6}>\r\n                                            {/*<Rate allowHalf disabled defaultValue={d.score}/>*/}\r\n                                        </Col>\r\n                                    </Row>\r\n                                </Card>\r\n                            </div>\r\n                        )\r\n                    }\r\n                })}\r\n            </Col>\r\n        </Row>\r\n    )\r\n}\r\n\r\nexport default withRouter(Result)"]},"metadata":{},"sourceType":"module"}